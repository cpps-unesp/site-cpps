---
import slugify from "slugify";

const { noticias, lang, texts } = Astro.props;

// Get all unique tags
const allTags = [...new Set(noticias.flatMap((post: any) => post.data.tags || []))].sort();

// Get recent posts (excluding featured if we want, but let's just show top 5)
const recentPosts = noticias.slice(0, 5);
---

<aside class="space-y-12">
  <!-- Search Widget -->
  <div class="bg-base-100 p-6 rounded-xl shadow-sm border border-base-200">
    <h3 class="text-xl font-bold mb-4 text-primary border-b-2 border-primary pb-2 inline-block">
      {texts.header.buscar || 'Buscar'}
    </h3>
    <div class="relative mt-2">
      <label for="search-modal" class="flex items-center w-full px-4 py-2 bg-base-200 rounded-lg cursor-pointer hover:bg-base-300 transition-colors">
        <span class="text-base-content opacity-60">Pesquisar not√≠cias...</span>
        <span class="ml-auto">üîç</span>
      </label>
    </div>
  </div>

  <!-- Categories/Tags Widget -->
  <div class="bg-base-100 p-6 rounded-xl shadow-sm border border-base-200">
    <h3 class="text-xl font-bold mb-4 text-primary border-b-2 border-primary pb-2 inline-block">
      Categorias
    </h3>
    <div class="flex flex-wrap gap-2 mt-2">
      {allTags.map(tag => (
        <a
          href={`/${lang}/noticias/categoria/${slugify(tag, { lower: true, strict: true })}`}
          class="px-3 py-1 bg-secondary/10 text-secondary hover:bg-secondary hover:text-white rounded-full text-sm font-medium transition-colors"
        >
          {tag}
        </a>
      ))}
    </div>
  </div>

  <!-- Recent Posts Widget -->
  <div class="bg-base-100 p-6 rounded-xl shadow-sm border border-base-200">
    <h3 class="text-xl font-bold mb-4 text-primary border-b-2 border-primary pb-2 inline-block">
      Mais Recentes
    </h3>
    <div class="space-y-4 mt-2">
      {recentPosts.map((post: any) => (
        <a href={`/${lang}/noticias/${post.slug}`} class="group block">
          <p class="text-xs text-base-content/60 mb-1">
            {new Date(post.data.date).toLocaleDateString(lang === 'pt' ? 'pt-BR' : 'en-US')}
          </p>
          <h4 class="font-bold text-base group-hover:text-primary transition-colors line-clamp-2">
            {post.data.title}
          </h4>
        </a>
      ))}
    </div>
  </div>
</aside>
