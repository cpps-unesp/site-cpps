---
import slugify from 'slugify';
import { getTranslations, type Language } from '../utils/i18n';
import type { CollectionEntry } from 'astro:content';

interface Props {
  noticias: CollectionEntry<'noticias'>[];
  lang: string;
}

const { noticias, lang } = Astro.props;
const locale = getTranslations(lang as Language);

// Get all unique tags
const allTags = [...new Set(noticias.flatMap((post) => post.data.tags || []))].sort();

// Get recent posts (excluding featured if we want, but let's just show top 5)
const recentPosts = noticias.slice(0, 5);
---

<aside class="space-y-12">
  <!-- Search Widget -->
  <div class="bg-base-100 border-base-200 rounded-xl border p-6 shadow-sm">
    <h3 class="text-primary border-primary mb-4 inline-block border-b-2 pb-2 text-xl font-bold">
      {locale.texts.header?.buscar || 'Buscar'}
    </h3>
    <div class="relative mt-2">
      <label
        for="search-modal"
        class="bg-base-200 hover:bg-base-300 flex w-full cursor-pointer items-center rounded-lg px-4 py-2 transition-colors"
      >
        <span class="text-base-content opacity-60"
          >{locale.noticias?.search || 'Pesquisar not√≠cias...'}</span
        >
        <span class="ml-auto">üîç</span>
      </label>
    </div>
  </div>

  <!-- Categories/Tags Widget -->
  <div class="bg-base-100 border-base-200 rounded-xl border p-6 shadow-sm">
    <h3 class="text-primary border-primary mb-4 inline-block border-b-2 pb-2 text-xl font-bold">
      {locale.noticias?.categories || 'Categorias'}
    </h3>
    <div class="mt-2 flex flex-wrap gap-2">
      {
        allTags.map((tag: string) => (
          <a
            href={`/${lang}/noticias/categoria/${slugify(tag, { lower: true, strict: true })}`}
            class="bg-secondary/10 text-secondary hover:bg-secondary rounded-full px-3 py-1 text-sm font-medium transition-colors hover:text-white"
          >
            {tag}
          </a>
        ))
      }
    </div>
  </div>

  <!-- Recent Posts Widget -->
  <div class="bg-base-100 border-base-200 rounded-xl border p-6 shadow-sm">
    <h3 class="text-primary border-primary mb-4 inline-block border-b-2 pb-2 text-xl font-bold">
      {locale.noticias?.recent || 'Mais Recentes'}
    </h3>
    <div class="mt-2 space-y-4">
      {
        recentPosts.map((post) => (
          <a href={`/${lang}/noticias/${post.slug}`} class="group block">
            <p class="text-base-content/60 mb-1 text-xs">
              {new Date(post.data.date).toLocaleDateString(lang === 'pt' ? 'pt-BR' : 'en-US')}
            </p>
            <h4 class="group-hover:text-primary line-clamp-2 text-base font-bold transition-colors">
              {post.data.title}
            </h4>
          </a>
        ))
      }
    </div>
  </div>
</aside>
