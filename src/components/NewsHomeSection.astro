---
import { getCollection } from 'astro:content';
import NoticiaCard from './NoticiaCard.astro';
import routeTranslations from '../i18n/routeTranslations';
import { getTranslations } from '../utils/i18n';

const { lang, title } = Astro.props;
const locale = getTranslations(lang);

const allNoticias = await getCollection('noticias');
const recentNoticias = allNoticias
  .filter(post => post.data.lang === lang)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3);

if (recentNoticias.length === 0) return null;

const noticiasPath = routeTranslations['noticias'][lang as keyof typeof routeTranslations['noticias']];
---

<section class="py-16 bg-base-200/50">
  <div class="container mx-auto px-4">
    <div class="flex justify-between items-end mb-10">
      <div>
        <h2 class="text-4xl font-bold text-primary mb-2">{title || locale.noticias?.recent || 'Últimas Notícias'}</h2>
        <div class="w-20 h-1.5 bg-primary"></div>
      </div>
      <a href={`/${lang}/${noticiasPath}`} class="btn btn-primary btn-outline">
        {locale.noticias?.allNews || 'Ver Todas'}
      </a>
    </div>

    <div class="grid gap-8 md:grid-cols-3">
      {recentNoticias.map(post => (
        <NoticiaCard
          title={post.data.title}
          resumo={post.data.resumo}
          image={post.data.image}
          tags={post.data.tags}
          slug={`/${lang}/noticias/${post.slug}`}
          lang={lang}
          date={post.data.date}
          author={post.data.author}
        />
      ))}
    </div>
  </div>
</section>
