---
import type { SupportedLang } from "../types/lang";
import { getTranslations } from "../utils/i18n";

interface Props {
  publication: any;
  lang: SupportedLang;
}

const { publication, lang } = Astro.props;
const { data, slug } = publication;
const locale = getTranslations(lang);

const typeLabel = locale.publicacoes.types[data.type] || data.type;

// Cores baseadas no tipo
const typeColors: Record<string, string> = {
  'artigo': 'bg-blue-100 text-blue-800 border-blue-200',
  'analise': 'bg-purple-100 text-purple-800 border-purple-200',
  'material-didatico': 'bg-green-100 text-green-800 border-green-200',
  'texto-curto': 'bg-amber-100 text-amber-800 border-amber-200',
  'texto-longo': 'bg-indigo-100 text-indigo-800 border-indigo-200',
};

const badgeClass = typeColors[data.type] || 'bg-gray-100 text-gray-800 border-gray-200';

const formattedDate = new Intl.DateTimeFormat(lang, {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
}).format(data.date);

const authorsList = data.authors.join(", ");
---

<div class="publication-card bg-base-100 border border-base-200 p-6 rounded-2xl shadow-sm hover:shadow-xl hover:border-primary/20 transition-all duration-300 flex flex-col h-full group"
     data-type={data.type}
     data-authors={authorsList.toLowerCase()}
     data-title={data.title.toLowerCase()}>
  <div class="flex items-center gap-3 mb-4">
    <a
      href={`/${lang}/publicacoes?type=${encodeURIComponent(data.type)}`}
      class={`text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded-md border ${badgeClass} hover:opacity-80 transition-opacity`}
    >
      {typeLabel}
    </a>
    <span class="text-xs opacity-50 font-medium">{formattedDate}</span>
  </div>

  <h3 class="text-xl font-bold text-base-content mb-3 leading-tight publication-card-title group-hover:text-primary transition-colors">
    <a href={`/${lang}/publicacoes/${slug}`}>
      {data.title}
    </a>
  </h3>

  <p class="text-sm font-medium text-base-content/80 mb-4">
    <span class="opacity-50 font-normal">{locale.publicacoes.authors}:</span>
    {data.authors.map((author: string, index: number) => (
      <>
        <a
          href={`/${lang}/publicacoes?author=${encodeURIComponent(author)}`}
          class="hover:text-primary hover:underline transition-colors"
        >
          {author}
        </a>
        {index < data.authors.length - 1 ? ', ' : ''}
      </>
    ))}
  </p>

  <p class="text-base-content/70 text-sm line-clamp-3 mb-6 flex-grow leading-relaxed">
    {data.summary}
  </p>

  <div class="flex items-center justify-between mt-auto pt-4 border-t border-base-200/50">
    <a href={`/${lang}/publicacoes/${slug}`} class="text-primary font-bold text-sm inline-flex items-center gap-2 hover:gap-3 transition-all">
      {locale.publicacoes.readMore}
      <i class="fa-solid fa-arrow-right text-xs"></i>
    </a>

    {data.pdf_url && (
      <a href={data.pdf_url} target="_blank" class="text-base-content/40 hover:text-red-500 transition-colors" title={locale.publicacoes.downloadPdf}>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      </a>
    )}
  </div>
</div>

<style>
  .publication-card-title {
    font-family: 'Montserrat', sans-serif !important;
    text-transform: none !important;
  }
</style>
