---
type CafeMaterial = {
  nome: string;
  url: string;
};

type CafeEpisodio = {
  titulo: string;
  descricao: string;
  materiais?: CafeMaterial[];
};

type CafeData = {
  titulo: string;
  descricao: string;
  episodios: CafeEpisodio[];
};

const { cafe, lang } = Astro.props as { cafe: CafeData; lang?: string };

function buildUrl(url?: string) {
  if (!url || url.startsWith('http')) return url;
  if (!lang) return url;
  if (url.startsWith(`/${lang}/`) || url === `/${lang}`) return url;
  if (url.startsWith('/')) return `/${lang}${url}`;
  return `/${lang}/${url}`;
}
---

<section class="mt-16 space-y-16">
  <div class="text-center">
    <h2 class="mb-4 text-4xl font-extrabold">{cafe.titulo}</h2>
    <p class="text-base-content mx-auto max-w-2xl">{cafe.descricao}</p>
  </div>

  <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
    {
      cafe.episodios.map((episodio: CafeEpisodio) => (
        <div class="bg-base-100 flex flex-col space-y-4 rounded-xl p-6 shadow-md transition-shadow hover:shadow-lg">
          <div class="flex justify-center">
            <img
              src="/imagens/logos/logo-unesp-mapa.svg"
              alt="Logo UNESP Mapa"
              class="h-16 w-16 object-contain"
            />
          </div>
          <h3 class="text-lg font-bold">{episodio.titulo}</h3>
          <p class="text-base-content text-sm">{episodio.descricao}</p>

          {Array.isArray(episodio.materiais) && episodio.materiais.length > 0 && (
            <div class="mt-2 flex flex-wrap gap-2">
              {episodio.materiais.map((mat: CafeMaterial) => (
                <a
                  href={buildUrl(mat.url)}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="border-base-content hover:bg-base-200 rounded border px-3 py-1 text-xs font-bold uppercase transition-colors"
                >
                  {mat.nome}
                </a>
              ))}
            </div>
          )}
        </div>
      ))
    }
  </div>
</section>
