---
export const prerender = false;

import { getCollection } from 'astro:content';
import { normalizeLegacyAtividadesSlug } from '../../utils/wikiLegacyAliases';
import routeTranslations from '../../i18n/routeTranslations';

const slugParam = Astro.params.slug;
const slugPath = Array.isArray(slugParam) ? slugParam.join('/') : (slugParam ?? '');
const normalizedSlug = normalizeLegacyAtividadesSlug(slugPath);

if (normalizedSlug) {
  if (normalizedSlug === 'equipe') {
    return Astro.redirect(`/pt/${routeTranslations['institucional/equipe'].pt}`, 301);
  }

  const entries = await getCollection('atividades');
  const validSlugs = new Set(entries.map((entry) => entry.slug));

  if (validSlugs.has(normalizedSlug)) {
    const suffix = normalizedSlug === 'index' ? '' : `/${normalizedSlug}`;
    return Astro.redirect(`/pt/wiki${suffix}`, 301);
  }
}

return Astro.redirect('/pt/atividades', 302);
---
