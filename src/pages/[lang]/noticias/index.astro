---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  return [
    { params: { lang: 'pt' } },
    { params: { lang: 'en' } },
    { params: { lang: 'es' } },
  ];
}

const currentLang = Astro.params.lang ?? 'pt';

const allNoticias = await getCollection('noticias');
const noticias = allNoticias.filter(n => n.data.lang === currentLang);

const locale = await import(`../../../i18n/locales/${currentLang}.json`);
const { titulo, descricao, texts } = locale.default;
---

<BaseLayout lang={currentLang} titulo="Notícias" descricao={descricao} texts={texts}>
  <section class="mt-16">
    <h1 class="text-4xl font-bold mb-8">{texts.news ?? 'Notícias'}</h1>

    {noticias.length > 0 ? (
      <ul class="space-y-6">
        {noticias.map((noticia) => (
          <li>
            <a 
              href={`/${currentLang}/noticias/${noticia.slug}`} 
              class="text-2xl font-semibold text-primary hover:underline"
            >
              {noticia.data.title}
            </a>
            <p class="text-sm text-base-content">{noticia.data.date}</p>
            <p>{noticia.data.resumo}</p>
          </li>
        ))}
      </ul>
    ) : (
      <p>Nenhuma notícia disponível.</p>
    )}
  </section>
</BaseLayout>
