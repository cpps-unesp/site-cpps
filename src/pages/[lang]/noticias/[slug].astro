---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection, getEntry } from 'astro:content';

export async function getStaticPaths() {
  const langs = ['pt', 'en', 'es'];
  const allNoticias = await getCollection('noticias');

  return langs.flatMap(lang =>
    allNoticias
      .filter(n => n.data.lang === lang)
      .map(n => ({
        params: { lang, slug: n.slug }
      }))
  );
}

const { lang, slug } = Astro.params;

const entry = await getEntry('noticias', slug);

if (!entry) {
  throw new Error(`Notícia não encontrada: ${slug}`);
}

const { data, body } = entry;
const locale = await import(`../../../i18n/locales/${lang}.json`);
const { titulo, descricao, texts } = locale.default;
---

<BaseLayout lang={lang} titulo={data.title} descricao={data.resumo} texts={texts}>
  <article class="prose max-w-3xl mx-auto py-10">
    <h1 class="text-4xl font-bold mb-4">{data.title}</h1>
    <p class="text-sm text-base-content mb-6">{data.date}</p>
    <p class="mb-6">{data.resumo}</p>

    <div class="prose">
      {body}
    </div>
  </article>
</BaseLayout>
