---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import InitiativeCard from '../../components/InitiativeCard.astro';
import AtividadesSection from '../../components/AtividadesSection.astro';
import ProdutosSection from '../../components/ProdutosSection.astro';
import FAQSection from '../../components/FAQSection.astro';
import MostUsedWidgets from '../../components/MostUsedWidgets.astro';
import EquipeSection from '../../components/EquipeSection.astro';

// ✅ getStaticPaths para SSG
export function getStaticPaths() {
  return [
    { params: { lang: 'pt' } },
    { params: { lang: 'en' } },
    { params: { lang: 'es' } },
  ];
}

// ✅ Fallback padrão para lang
const currentLang = Astro.params.lang ?? 'pt';

// ✅ Validação de idioma
const allowedLangs = ['pt', 'en', 'es'];
if (!allowedLangs.includes(currentLang)) {
  return Astro.redirect('/pt/');
}

// ✅ Importação segura do locale
const locale = await import(`../../i18n/locales/${currentLang}.json`);

const { 
  titulo, 
  descricao, 
  texts, 
  equipe, 
  initiatives, 
  atividadesPesquisa, 
  atividadesExtensao, 
  produtos, 
  faqs, 
  widgets,
  imagens
} = locale.default;
---

<BaseLayout lang={currentLang} titulo={titulo} descricao={descricao} texts={texts}>
  <Hero heroData={locale.default} />

  <section class="mt-16">
    <p class="text-center text-primary font-semibold uppercase tracking-wide mb-2">{texts.initiatives}</p>
    <h2 class="text-center text-3xl font-extrabold mb-4">{texts.whatYouFind}</h2>
    <p class="text-center text-xl text-base-content mb-10 max-w-2xl mx-auto">
      Conheça nossas principais iniciativas, projetos e formas de atuação que promovem o desenvolvimento acadêmico e social.
    </p>

    <div class="grid gap-8 md:grid-cols-2">
      {initiatives.map((item: { icon: string; title: string; description: string }) => (
        <InitiativeCard icon={item.icon} title={item.title} description={item.description} />
      ))}
    </div>
  </section>

  <section class="mt-16">
    <p class="text-center text-primary font-semibold uppercase tracking-wide mb-2">{texts.activities}</p>
    <h2 class="text-center text-3xl font-extrabold mb-4">{texts.whatWeDo}</h2>
    <p class="text-center text-xl text-base-content mb-10 max-w-2xl mx-auto">
      Veja nossas principais atividades, que promovem ensino, pesquisa e extensão no CPPS.
    </p>
  </section>

  <AtividadesSection 
    title={texts.ourResearch} 
    description={texts.researchDescription} 
    image={imagens.pesquisa} 
    activities={atividadesPesquisa}
  />

  <AtividadesSection 
    title={texts.ourExtensions} 
    description={texts.extensionDescription} 
    image={imagens.extensao} 
    activities={atividadesExtensao} 
    reverse={true}
/>

  <ProdutosSection 
    title={texts.productsTitle} 
    image={imagens.produtos} 
    produtos={produtos}
  />

  <MostUsedWidgets widgets={widgets} />

  <FAQSection faqs={faqs} />

  <EquipeSection equipe={equipe} />
</BaseLayout>
