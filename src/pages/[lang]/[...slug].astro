---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import EquipeSection from '../../components/EquipeSection.astro';
import { routeTranslations } from '../../i18n/routes';

type SupportedLang = 'pt' | 'en' | 'es';

export function getStaticPaths() {
  const langs: SupportedLang[] = ['pt', 'en', 'es'];
  const allSlugs = Object.values(routeTranslations).flatMap(translations =>
    langs.map(lang => translations[lang])
  );
  return langs.flatMap(lang =>
    allSlugs.map(slug => ({
      params: { lang, slug }
    }))
  );
}

const currentLang = Astro.params.lang as SupportedLang ?? 'pt';
const slug = Astro.params.slug ?? '';
const slugArray = slug.split('/').filter(Boolean);
const slugPath = slugArray.join('/');

const locale = await import(`../../i18n/locales/${currentLang}.json`);
const { titulo, descricao, texts, equipe } = locale.default;

function findOriginalKey(translatedSlug: string, lang: SupportedLang): string | null {
  for (const [key, translations] of Object.entries(routeTranslations)) {
    if (translations[lang] === translatedSlug) {
      return key;
    }
  }
  return null;
}

const originalKey = findOriginalKey(slugPath, currentLang);
const pageContent = originalKey
  ? `Esta é a página ${originalKey} (${currentLang})`
  : null;
---

<BaseLayout lang={currentLang} titulo={titulo} descricao={descricao} texts={texts}>
  <Breadcrumbs lang={currentLang} slugArray={slugArray} texts={texts} />

  {originalKey === "institucional/equipe" ? (
    <EquipeSection equipe={equipe} />
  ) : pageContent ? (
    <>
      <h1 class="text-3xl font-bold mb-4">{slugArray.join(' / ')}</h1>
      <p class="mb-4">{pageContent}</p>
    </>
  ) : (
    <>
      <h1 class="text-3xl font-bold mb-4">404 - {texts.notFound}</h1>
      <p class="mb-4">Desculpe, não encontramos a página: <strong>{slugPath}</strong></p>
      <p>Idioma: <strong>{currentLang}</strong></p>
    </>
  )}
</BaseLayout>
