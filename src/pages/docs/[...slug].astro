---
export const prerender = true;
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

// Componentes customizados para o MDX
import Notice from '../../components/docs/Notice.astro';
import Card from '../../components/docs/Card.astro';
import CardGrid from '../../components/docs/CardGrid.astro';
import LinkCard from '../../components/docs/LinkCard.astro';
import Steps from '../../components/docs/Steps.astro';

// Componentes de estrutura da documentaÃ§Ã£o
import DocsSidebar from '../../components/docs/Sidebar.astro';
import TableOfContents from '../../components/docs/TableOfContents.astro';
import Breadcrumbs from '../../components/docs/Breadcrumbs.astro';
import Pagination from '../../components/docs/Pagination.astro';

import { sidebar } from '../../config/docs';

export async function getStaticPaths() {
  const docs = await getCollection('docs');
  return docs.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content, headings } = await render(entry);
const currentPath = Astro.url.pathname;
---

<BaseLayout titulo={entry.data.title} descricao={entry.data.description}>
  <div class="max-w-screen-2xl mx-auto px-4 md:px-8 py-12 flex flex-col lg:flex-row gap-8 lg:gap-12">

    <!-- ðŸ”¹ NavegaÃ§Ã£o Lateral (Sidebar) -->
    <aside class="w-full lg:w-72 flex-shrink-0">
        <nav class="sticky top-24 max-h-[calc(100vh-6rem)] overflow-y-auto pr-4 scrollbar-thin scrollbar-thumb-base-300">
            <h3 class="font-bold text-lg mb-6 text-primary flex items-center gap-2">
                <i class="fa-solid fa-book-open text-sm"></i>
                DocumentaÃ§Ã£o
            </h3>
            <DocsSidebar items={sidebar} currentPath={currentPath} />
        </nav>
    </aside>

    <!-- ðŸ”¹ ConteÃºdo Principal -->
    <main class="flex-1 min-w-0">
      <div class="max-w-4xl mx-auto">
        <Breadcrumbs currentPath={currentPath} />

        <article class="prose prose-lg max-w-none dark:prose-invert">
          <header class="mb-12 not-prose">
            <h1 class="titulo text-4xl sm:text-5xl mb-4 font-black">{entry.data.title}</h1>
            {entry.data.description && (
                <p class="text-xl text-base-content/60 leading-relaxed border-l-4 border-primary/20 pl-6 italic">
                    {entry.data.description}
                </p>
            )}
            <div class="divider mt-8"></div>
          </header>

          <Content components={{ Notice, Card, CardGrid, LinkCard, Steps }} />
        </article>

        <Pagination currentPath={currentPath} />

        <footer class="mt-16 pt-8 border-t border-base-300 text-sm text-base-content/50 flex justify-between items-center">
            <span>Â© {new Date().getFullYear()} CPPS - UNESP</span>
            <a href="https://github.com/cpps-unesp/site-cpps" target="_blank" class="hover:text-primary transition-colors flex items-center gap-2">
                <i class="fa-brands fa-github"></i>
                Editar no GitHub
            </a>
        </footer>
      </div>
    </main>

    <!-- ðŸ”¹ Tabela de ConteÃºdo (ToC) -->
    <TableOfContents headings={headings} />

  </div>
</BaseLayout>

<style is:global>
    /* Suaviza o scroll ao clicar nos links do ToC */
    html {
        scroll-behavior: smooth;
    }

    /* Ajuste de scroll-margin para compensar o header fixo */
    [id] {
        scroll-margin-top: 7rem;
    }
</style>
